<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âcole Notre-Dame des Gr√¢ces - Gestion des Pr√©sences</title>
    <link rel="stylesheet" href="style.css">

    <!-- Manifest PWA -->
    <link rel="manifest" href="manifest.json">

    <!-- Meta tags pour PWA -->
    <meta name="theme-color" content="#007bff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="NDG Pr√©sences">

    <!-- Icons pour iOS -->
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="icons/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="384x384" href="icons/icon-384x384.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icons/icon-512x512.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="flex flex-col items-center justify-center">
                    <h1>√âcole Notre-Dame des Gr√¢ces</h1>
                    <p>Gestion des pr√©sences - Ann√©e scolaire 2025-2026</p>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav">
            <div class="container">
                <div class="nav-tabs justify-center">
                    <button class="nav-tab active" data-tab="dashboard">
                        <span class="nav-icon">üè†</span>
                        Tableau de bord
                    </button>
                    <button class="nav-tab" data-tab="attendance">
                        <span class="nav-icon">üìç</span>
                        Pr√©sences
                    </button>
                    <button class="nav-tab" data-tab="children">
                        <span class="nav-icon">üë∂</span>
                        Enfants
                    </button>
                    <button class="nav-tab" data-tab="history">
                        <span class="nav-icon">üìä</span>
                        Historique
                    </button>
                    <button class="nav-tab" data-tab="settings">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        R√©glages
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main container">
            

            <!-- Dashboard Tab -->
            <div class="tab-content active" id="dashboard">

                <div id="emptyChildrenState" class="empty-state hidden">
                    <div class="empty-icon">üë∂</div>
                    <h3>Commencez par ajouter vos enfants</h3>
                    <p>Pour utiliser l'application, vous devez d'abord configurer vos enfants.</p>
                    <button onclick="app.switchTab('children')" class="btn btn--primary btn--lg">
                        ‚ûï Ajouter mes enfants
                    </button>
                </div>

                <div id="normalDashboardContent" class="dashboard">
                    
                    <div class="dashboard-header">
                        <h2>Tableau de bord</h2>
                        <div class="current-date"></div>
                    </div>
                    
                    <div class="cost-summary">
                        <div class="cost-card">
                            <h3>Co√ªt aujourd'hui</h3>
                            <div class="cost-amount" id="dailyCost">0,00 ‚Ç¨</div>
                        </div>
                        <div class="cost-card">
                            <h3>Co√ªt ce mois</h3>
                            <div class="cost-amount" id="monthlyCost">0,00 ‚Ç¨</div>
                        </div>
                    </div>

                    <div class="children-status" id="childrenStatus">
                        <!-- Children status will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Attendance Tab -->
            <div class="tab-content" id="attendance">
                <div class="attendance-section">
                    <div class="dashboard-header">
                        <h2>Enregistrement des pr√©sences</h2>
                    </div>
                    <div class="attendance-header">                        
                        <div class="date-selector">
                            <label class="form-label">Date :</label>
                            <input type="date" id="attendanceDate" class="form-control date-input">
                            <div class="current-day-info" id="currentDayInfo"></div>
                        </div>
                        <div class="child-selection">
                            <label class="form-label">S√©lectionner un enfant :</label>
                            <select class="form-control" id="childSelect">
                                <option value="">-- Choisir un enfant --</option>
                            </select>
                        </div>

                    </div>

                    

                    <div class="attendance-grid" id="attendanceGrid">
                        <!-- Attendance options will be populated here -->
                    </div>

                    <div class="daily-summary" id="dailySummary">
                        <!-- Daily cost summary -->
                    </div>
                </div>
            </div>

            <!-- Children Tab -->
            <div class="tab-content" id="children">
                <div class="children-section">
                    <div class="dashboard-header">
                        <h2>Configuration des enfants</h2>
                    </div>
                    
                    <div class="children-list">
                        <h3 class="dashboard-header">Enfants configur√©s</h3>
                        <div id="childrenList">
                            <!-- Children list will be populated here -->
                        </div>
                    </div>
                    
                    <div class="add-child-form">
                        <h3 class="dashboard-header">Ajouter un enfant</h3>
                        <form id="addChildForm">
                            <div class="form-group">
                                <label class="form-label">Nom de l'enfant</label>
                                <input type="text" class="form-control" id="childName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Classe</label>
                                <input type="text" class="form-control" id="childClass" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Niveau</label>
                                <select class="form-control" id="childLevel" required>
                                    <option value="">-- Choisir --</option>
                                    <option value="maternelle">Maternelle</option>
                                    <option value="primaire">Primaire</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">QR Code (image)</label>
                                <input type="file" class="form-control" id="childQRCode" accept="image/*">
                            </div>
                            <button type="submit" class="btn btn--primary">Ajouter l'enfant</button>
                        </form>
                    </div>

                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="history">
                <div class="history-section">
                    <h2 class="dashboard-header">Historique et rapports</h2>
                    
                    <div class="history-controls">
                        <div class="form-group">
                            <label class="form-label">Mois √† afficher</label>
                            <select class="form-control" id="monthSelect">
                                <!-- Options will be populated -->
                            </select>
                        </div>
                    </div>

                    <div class="monthly-summary">
                        <div class="summary-cards">
                            <div class="summary-card">
                                <h4>Co√ªt calcul√©</h4>
                                <div class="summary-amount" id="calculatedCost">0,00 ‚Ç¨</div>
                            </div>
                            <div class="summary-card">
                                <h4>Facture Dynamix</h4>
                                <div class="invoice-input">
                                    <input type="number" class="form-control" id="invoiceAmount" step="0.01" placeholder="0,00">
                                    <span>‚Ç¨</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <h4>Diff√©rence</h4>
                                <div class="summary-amount" id="difference">0,00 ‚Ç¨</div>
                            </div>
                        </div>
                    </div>

                    <div class="calendar-view" id="calendarView">
                        <!-- Calendar will be populated here -->
                    </div>

                    <div class="export-actions">
                        <button class="btn btn--secondary" id="exportBtn">Exporter en CSV</button>
                        <button class="btn btn--outline" id="resetDataBtn">R√©initialiser les donn√©es</button>
                    </div>
                </div>
            </div>

            <!-- Setting Tab -->
            <div class="tab-content" id="settings">
                <!-- Section Synchronisation Cloud (r√©utilise vos classes existantes) -->
                <div class="card">
                    <div class="card__body">
                        <h2 class="dashboard-header">üîÑ Synchronisation Cloud</h2>
                        
                        <!-- Statut de la synchronisation -->
                        <div class="sync-status" id="syncStatus">
                            <span class="status-indicator" id="statusIndicator">‚≠ï</span>
                            <span class="status--info" id="statusText">Non configur√©</span>
                        </div>
                        
                        <!-- Formulaire de configuration -->
                        <form id="syncConfigForm" class="form">
                            <div class="form-group">
                                <label for="supabaseUrl" class="form-label">URL du projet Supabase</label>
                                <input 
                                    type="url" 
                                    id="supabaseUrl" 
                                    placeholder="https://votre-projet.supabase.co" 
                                    class="form-control">
                                <small class="form-help">Trouvez cette URL dans Settings ‚Üí API de votre projet Supabase</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="supabaseKey" class="form-label">Service Role Key</label>
                                <input 
                                    type="password" 
                                    id="supabaseKey" 
                                    placeholder="eyJ..." 
                                    class="form-control">
                                <small class="form-help">‚ö†Ô∏è Utilisez la Service Role Key (pas l'anon key)</small>
                            </div>
                            
                            <!-- NOUVEAU CHAMP -->
                            <div class="form-group">
                                <label for="fileName" class="form-label">Nom du fichier de donn√©es</label>
                                <input 
                                    type="text" 
                                    id="fileName" 
                                    placeholder="mes-donnees.json" 
                                    class="form-control"
                                    value="attendance-data.json">
                                <small class="form-help">üí° Utilisez un nom unique si vous partagez le compte (ex: marie-donnees.json)</small>
                            </div>
                            
                            <div class="flex gap-8">
                                <button type="submit" class="btn btn--primary">
                                    Configurer la synchronisation
                                </button>
                                <button 
                                    type="button" 
                                    id="disconnectSync" 
                                    class="btn btn--secondary" 
                                    style="display: none;">
                                    D√©connecter
                                </button>
                            </div>
                        </form>

                        
                        <!-- Actions de synchronisation -->
                        <div class="sync-actions" id="syncActions" style="display: none;">
                            <div class="flex gap-8 mb-8">
                                <button id="backupBtn" class="btn btn--primary">
                                    üì§ Sauvegarder
                                </button>
                                <button id="restoreBtn" class="btn btn--secondary">
                                    üì• Restaurer
                                </button>
                            </div>
                            
                            <div class="sync-info">
                                <small class="text-secondary">
                                    Version cloud : <span id="cloudLastBackup">Jamais</span><br>
                                    Derni√®re sauvegarde locale : <span id="lastBackup">Jamais</span>
                                </small>
                                <div id="conflictWarning" class="conflict-warning" style="display: none;">
                                    ‚ö†Ô∏è <span id="conflictMessage"></span>                                    
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>

        </main>

        <!-- Notifications -->
        <div class="notifications" id="notifications"></div>

        <!-- Modal Day Details -->
        <div class="modal hidden" id="dayDetailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="dayDetailsTitle">D√©tail de la journ√©e</h3>
                    <span class="modal-close">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="dayDetailsContent"></div>
                    <div class="modal-actions">
                        <button id="deleteDayBtn" class="btn btn--danger">
                            üóëÔ∏è Supprimer cette journ√©e
                        </button>
                        <button id="closeDayDetailsBtn" class="btn btn--secondary">
                            Fermer
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Confirmation Modal -->
        <div class="modal hidden" id="confirmModal">
            <div class="modal-content">
                <h3 id="confirmTitle">Confirmation</h3>
                <p id="confirmMessage">√ätes-vous s√ªr de vouloir effectuer cette action ?</p>
                <div class="modal-actions">
                    <button class="btn btn--secondary" id="confirmCancel">Annuler</button>
                    <button class="btn btn--primary" id="confirmOk">Confirmer</button>
                </div>
            </div>
        </div>

    </div>

    <script src="app.js"></script>
</body>
</html>